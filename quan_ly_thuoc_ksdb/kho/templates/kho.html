<!-- kho.html -->
{% extends "base.html" %}
{% block title %}Kho thuốc{% endblock title %}
{% load humanize %}
{% block content %}
<div class="container mt-5">
    <h2 class="text-center">Kho thuốc</h2>
    <br>
    <!-- Nút thêm mới -->
    <div class="mb-4 text-end">
        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#nhapKhoModal">
            Nhập kho
        </button>
    </div>

    <table class="table table-bordered">
        <thead>
            <tr align='center'>
                <th>STT</th>
                <th>Ngày nhập</th>
                <th>Tên thuốc</th>
                <th>Đơn vị tính</th>
                <th>Đơn giá</th>
                <th>Tồn đầu</th>
                <th>Nhập</th>
                <th>Xuất</th>
                <th>Tồn cuối</th>
            </tr>
        </thead>
        <tbody>
            {% for thuoc in thuoc %}
            <tr>
                <td align='center'>{{forloop.counter}}</td>
                <td align='center'>{{ thuoc.ngay_nhap }}</td>
                <td>{{ thuoc.ten_thuoc }}</td>
                <td align='center'>{{thuoc.dvt}}</td>
                <td align='center'>{{ thuoc.don_gia|floatformat:0|intcomma }}</td>
                <td align='center'>{{thuoc.ton_dau}}</td>
                <td align='center'>{{thuoc.nhap}}</td>
                <td align='center'>{{thuoc.xuat}}</td>
                <td align='center'>{{thuoc.ton_cuoi}}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9" class="text-center">Không có thuốc nào trong kho.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <!--Modal thêm-->
    <div class="modal fade" id="nhapKhoModal" tabindex="-1" aria-labelledby="nhapKhoLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="nhapKhoModalLabel">Phiếu nhập kho</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="POST" action="{% url 'nhap_thuoc' %}">
                        {% csrf_token %}
                        <div class="form-group mb-3">
                            <label for="ten_thuoc">Tên thuốc</label>
                            <select class="form-control" id="ten_thuoc" name="ten_thuoc">
                                <option value="">--- Chọn thuốc ---</option>
                                {% for thuoc in form.thuoc %}
                                <option value="{{ thuoc.id }}">{{ thuoc.ten_thuoc }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label for="dvt">ĐVT</label>
                            <input type="text" class="form-control" id="dvt" name="dvt" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="don_gia">Đơn giá</label>
                            <input type="number" class="form-control" id="don_gia" name="don_gia" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="so_luong_nhap">Số lượng nhập</label>
                            <input type="number" class="form-control" id="so_luong_nhap" name="so_luong_nhap" required>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">Thêm</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
